{% extends 'base.html' %}

{% block title %} Results {% endblock %}

{% block content %}
<div class="container py-5 d-flex justify-content-center">
    <div class="col-12 col-md-8 col-lg-6">
        <div class="main-card fade-in-up text-center">
            <h1 class="display-6 mb-4">Your Nutrition Summary</h1>
            
            <div class="row g-3">
                <div class="col-6">
                    <div class="p-3 rounded" style="background: rgba(255, 255, 255, 0.05);">
                        <h3 class="h5 text-warning mb-1">Calories</h3>
                        <p class="h4 mb-0">{{ data["calories"]|round|int }}<span class="small text-muted">kcal</span></p>
                    </div>
                </div>
                <div class="col-6">
                    <div class="p-3 rounded" style="background: rgba(255, 255, 255, 0.05);">
                        <h3 class="h5 text-info mb-1">Protein</h3>
                        <p class="h4 mb-0">{{ data["protein"]|round|int }}<span class="small text-muted">g</span></p>
                    </div>
                </div>
                <div class="col-6">
                    <div class="p-3 rounded" style="background: rgba(255, 255, 255, 0.05);">
                        <h3 class="h5 text-success mb-1">Carbs</h3>
                        <p class="h4 mb-0">{{ data["carbs"]|round|int }}<span class="small text-muted">g</span></p>
                    </div>
                </div>
                <div class="col-6">
                    <div class="p-3 rounded" style="background: rgba(255, 255, 255, 0.05);">
                        <h3 class="h5 text-danger mb-1">Fat</h3>
                        <p class="h4 mb-0">{{ data["fat"]|round|int }}<span class="small text-muted">g</span></p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="p-3 rounded" style="background: rgba(255, 255, 255, 0.05);">
                        <h3 class="h5 text-secondary mb-1">Sugar</h3>
                        <p class="h4 mb-0">{{ data["sugar"]|round|int }}<span class="small text-muted">g</span></p>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                {% if food_items %}
                <a href="shortcuts://run-shortcut?name=LogCalMacros&input=text&text={% for item in food_items %}name={{ item.name|urlencode }}&calories={{ item.calories|round(2) }}&fat={{ item.fat|round(2) }}&sugar={{ item.sugar|round(2) }}&carbs={{ item.carbs|round(2) }}&protein={{ item.protein|round(2) }}{% if not loop.last %}%0A{% endif %}{% endfor %}"
                   class="btn btn-success btn-lg mb-3 w-100">
                    Log to Foodnoms
                </a>
                {% endif %}

                <a href="/" class="btn btn-primary mb-3 w-100">Calculate Another Meal</a>

                <div class="mt-4 pt-3 border-top">
                    <p class="text-muted small mb-2">First time?</p>
                    <div class="d-flex gap-2">
                        <a href="https://apps.apple.com/us/app/nutrition-tracker-foodnoms/id1479461686"
                           class="btn btn-outline-primary btn-sm flex-fill">
                            1. Get FoodNoms App
                        </a>
                        <a href="https://www.icloud.com/shortcuts/548aa54e366f43399108dad097520533"
                           class="btn btn-outline-primary btn-sm flex-fill">
                            2. Get iOS Shortcut
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Console log all food items in a single statement with newlines
    {% if food_items %}
        console.log("{% for item in food_items %}name={{ item.name }}&calories={{ item.calories|round(2) }}&fat={{ item.fat|round(2) }}&sugar={{ item.sugar|round(2) }}&carbs={{ item.carbs|round(2) }}&protein={{ item.protein|round(2) }}{% if not loop.last %}\n{% endif %}{% endfor %}");
    {% endif %}
</script>
{% endblock %}

